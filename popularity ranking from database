<?php
echo "<form action = '#' method='POST' class='dateform'>";
echo "Search by date: <input type='text' name='datefilter' class='datepicker'> 
<input type='submit' name='go' value='Go' id='go'>
</form> <br>";

$events = array();
$max = $conn->query("SELECT MAX(id) AS id FROM events")->fetch_object()->id;
$result  = $conn->query("SELECT * FROM events");
$num_rows = $result->num_rows;


for($j= 0; $j< $num_rows; ++$j)
{

$num = -1;
$mostpopular = 0;
for($i = 1; $i<=$max; ++$i)
{
	
	$idcheck = $conn->query("SELECT id FROM events WHERE id=$i")->fetch_object()->id;
	while($idcheck == NULL)
	{
		++$i;
		$idcheck = $conn->query("SELECT id FROM events WHERE id=$i")->fetch_object()->id;
	}

		$available = TRUE;
		for($k = 0; $k<count($events); ++$k)
		{
		if($events[$k] == $i)
		{
			$available = FALSE;
		}
		}

		if($available == TRUE)
		{
		$peoplegoing = $conn->query("SELECT * FROM votes WHERE event_id = $idcheck");
		$numpeople = $peoplegoing->num_rows;

		if($numpeople > $num)
		{
			$num = $numpeople;
			$mostpopular = $i;
		}
		}

}

$events[] = $mostpopular;
}


for($k = 0; $k<count($events); ++$k)
		{
			$i = $events[$k];
			$title = $conn->query("SELECT title FROM events where id=$i")->fetch_object()->title;
			$id = $conn->query("SELECT id FROM events where id=$i")->fetch_object()->id;
			$date = $conn->query("SELECT edate FROM events where id=$i")->fetch_object()->edate;
			$title = htmlspecialchars($title, ENT_QUOTES);
			
			echo "<div class='eventitem'><form action=event's page method='GET'>
			<input type = 'hidden' name='id' value='$id' />
			<input type = 'submit' name='eventlink' value= '$title' class='eventlink' /><div class='minitime'> $date </div>
			</form>
			</div>";
		}
}


?>
